<!DOCTYPE html>
<html>
<head>
    <title>Listening History</title>
    <link rel="stylesheet" type="text/css" href="{% static 'styles.css' %}">
</head>
<body>
    <h1>Listening History</h1>
    <button id="fetch-history">Fetch Listening History</button>

    <div id="listening-history-data">
        <!-- Display the listening history data here -->
        <ul>
            {% for item in listening_history.items %}
            <li>
                <strong>Track Name:</strong> {{ item.track.name }}<br>
                <strong>Artist:</strong> {{ item.track.artists.0.name }}<br>
                <strong>Album:</strong> {{ item.track.album.name }}<br>
                <strong>Release Date:</strong> {{ item.track.album.release_date }}<br>
                <strong>Preview URL:</strong> <a href="{{ item.track.preview_url }}" target="_blank">Listen</a>
            </li>
            {% endfor %}
        </ul>
    </div>

    <script>
        document.getElementById('fetch-history').addEventListener('click', function() {
            // Send an AJAX request to retrieve listening history
            fetch('/get_listening_history/')
                .then(response => response.json())
                .then(data => {
                    // Display the listening history data on the page
                    const listeningHistoryData = document.getElementById('listening-history-data');
                    listeningHistoryData.innerHTML = ''; // Clear previous data
                    const ul = document.createElement('ul');
                    data.listening_history.items.forEach(item => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <strong>Track Name:</strong> ${item.track.name}<br>
                            <strong>Artist:</strong> ${item.track.artists[0].name}<br>
                            <strong>Album:</strong> ${item.track.album.name}<br>
                            <strong>Release Date:</strong> ${item.track.album.release_date}<br>
                            <strong>Preview URL:</strong> <a href="${item.track.preview_url}" target="_blank">Listen</a>
                        `;
                        ul.appendChild(li);
                    });
                    listeningHistoryData.appendChild(ul);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    </script>
</body>
</html>
